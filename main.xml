<?xml version="1.0" encoding="UTF-8" ?>
<Module specificationVersion="1.3">
<ModulePrefs title="Requirement AI Analyzer" height="130" scrolling="true">
    <Require feature="com.ibm.rdm.rm.api"/>
    <Require feature="dynamic-height"/>
</ModulePrefs>

<Content type="html">
    <![CDATA[
        <html>
            <head>
                <!-- Language settings -->
                <meta charset="utf-8">
                <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    
				<script type="text/javascript" src="./lang_en.js" charset="utf-8"></script>       
    
				<!-- Importing bootstrap and jQuery -->
				<script src="js/jquery-3.6.1.js"></script>
				<link href="css/bootstrap.min.css" rel="stylesheet">
				<script src="js/bootstrap.bundle.min.js"></script>

                <!-- Attempt to load envg.js; if it fails, load env.js -->
                <script type="text/javascript">
                    function loadScript(url, onSuccess, onError) {
                        var script = document.createElement("script");
                        script.type = "text/javascript";
                        script.src = url;
                
                        script.onload = function() {
                            console.log(url + ' loaded successfully.');
                            if (onSuccess) onSuccess();
                        };
                
                        script.onerror = function() {
                            console.warn('Failed to load script: ' + url);
                            if (onError) onError();
                        };
                
                        document.head.appendChild(script);
                    }
                
                    // Try to load envg.js
                    loadScript('envg.js', null, function() {
                        // If envg.js fails to load, try env.js
                        console.log('Loading env.js as a fallback.');
                        loadScript('env.js');
                    });
                </script>

				<link href="css/carbon-components.min.css" rel="stylesheet">
				<script src="js/carbon-components.min.js"></script>

                <!-- Main .js-code -->
				<script type="text/javascript" src="./js/main_gf.js" charset="utf-8"></script> 

                <style>
                    #container::-webkit-scrollbar {
                        -webkit-appearance: none;
                        width: 7px;
                    }

                    #container::-webkit-scrollbar-thumb {
                        border-radius: 4px;
                        background-color: rgba(0, 0, 0, .5);
                        -webkit-box-shadow: 0 0 1px rgba(255, 255, 255, .5);
                    }
                    table {
                        font-family: arial, sans-serif;
                        border-collapse: collapse;
                        width: 100%;
                        }

                        td, th {
                        border: 1px solid #dddddd;
                        text-align: left;
                        padding: 4px;
                        }

                        tr:nth-child(even) {
                        background-color: #dddddd;
                    }
					.custom-row {
                        padding-top: 4px;
                        padding-bottom: 4px;
                        padding-left: 8px;
                    }
                    p:empty::before {
                        content:"";
                        display:inline-block;
                    }
                      .analysis-result {
                        font-size: 12px;
                    }
                    .analysis-result p {
                        margin: 0;
                        font-size: inherit;
                    }
                    .analysis-result strong {
                        display: block;
                        margin-top: 10px;
                    }
                </style>
            </head>
            <body onload='onBodyLoad();'>

                <table style='margin-top: 5px; border: 0'>
                    <tr>
                        <td style='text-align: center; font-size:12px;'><a onclick='show_instructions();' style='color:#00F; text-decoration: underline;' id='instructions_button'><span id='str001'></span></a></td>
                        <td style='text-align: center; font-size:12px;'><a onclick='show_settings();' style='color:#00F; text-decoration: underline;' id='settings_button'><span id='str002'></span></a></td>
                    </tr>
                </table>

                <hr style='padding: 0 !important; margin: 0 !important;'/>

                <div style="font-size:12px; display: none;" id='instructions_div'>
                    <b><span id='str003'></span> </b> <span id='str004'></span> <br/>
                    <ol>
                        <li> <span id='str005'></span> </li>
                        <li> <span id='str006'></span> </li>
                        <li> <span id='str007'></span></li>
                    </ol>

                    <hr style='padding: 0 !important; margin: 0 !important;'/>
                </div>
                
                <div style="font-size:12px; display: none;" id='settings_div'>
                    <b><span id='str008'>  </span> </b><br/>
                    <label for="apiKeyInput" style="font-size:12px;">OpenAI API key</label>
                    <input type="password" id="apiKeyInput" style="width: 100%;" placeholder="API Key"/>
                    <button type="button" id="saveCookie" style="font-size:12px;" onclick="saveApiKeyAsCookie();">Save Key on this computer as Cookie</button>
                    <button type="button" id="removeCookie" style="font-size:12px;" onclick="removeApiKeyCookie();">Remove Cookie</button>
                    <hr style='padding: 0 !important; margin: 0 !important;'/>
                </div>

                <div style="font-size:12px;">
                    <b><span id='str010' hidden></span></b>
                    <div style="overflow-y: scroll; max-height:80px; background-color:#EEE;" id='container'></div>
                </div>

            
                <div class="bx--col custom-row" style="text-align: left; border:0; padding-top: 0">
                    <table style='margin-top: 0px; border: 0'>
                        <tr>
                            <td style='text-align: left; border:0;'>
                                <button class="bx--btn bx--btn--primary bx--btn--md" type="button" style="font-size:12px;" onclick="readArtefact('incose');">Analyze</button>
                            </td>
                            <td style='text-align: left; border:0; display: none' id="updateButton">
                                <button class="bx--btn bx--btn--default bx--btn--md" type="button" style="font-size:12px;" onclick="updateArtifact();" >Update</button>
                            </td>
                            <td style='text-align: left; border:0; display: none' id="undoButton">
                                <button class="bx--btn bx--btn--default bx--btn--md" type="button" style="font-size:12px;" onclick="undoUpdate();">Undo</button>
                            </td>
                    </table>
                </div>

                <div style="font-size:12px;" id='aiResultText'>

                </div>

                <input type="hidden" id="revisedRequirement" />
                <input type="hidden" id="originalRequirement" />
                
            </body>
        </html>
    ]]>
</Content>
</Module>
